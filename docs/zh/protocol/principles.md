# 开发原则

本文档定义了指导 Nuxt 4 项目中所有开发决策和架构选择的基本原则。这些原则确保整个代码库的一致性、可维护性和质量。

## 核心原则

### 1. 分离上下文架构
**原则**: 严格遵循 Nuxt 4 的目录结构，分离客户端 (`app/`)、服务端 (`server/`) 和共享逻辑 (`shared/`)。

**实施方式**:
- 客户端代码必须位于 `app/` 目录
- 服务端逻辑必须包含在 `server/` 目录内
- 共享工具和类型必须放置在 `shared/` 目录
- 不允许上下文间的交叉污染（如在服务端代码中使用 Vue 组件）

**验证标准**:
- [ ] 所有 Vue 组件都在 `app/` 目录中
- [ ] 所有 API 路由都在 `server/` 目录中
- [ ] 所有共享工具没有副作用且无框架依赖
- [ ] 目录结构验证通过自动化检查

### 2. 单一数据源
**原则**: 配置、常量和类型定义必须集中管理。禁止魔法字符串和数字。

**实施方式**:
- 所有常量必须定义在 `shared/constants/` 或 `app/constants/` 中
- 配置值必须使用环境变量或集中的配置文件
- 类型定义必须通过 `shared/types/` 或 `app/types/` 共享
- 硬编码值必须提取到适当的常量文件中

**验证标准**:
- [ ] 代码中没有魔法字符串或数字
- [ ] 所有配置使用集中化源
- [ ] 常量被正确分类和导出
- [ ] 类型定义在模块间重用

### 3. 代码即文档
**原则**: 代码必须通过清晰的命名、结构化注释和类型定义实现自解释。

**实施方式**:
- 使用描述性的变量和函数名来解释意图
- 为所有公共 API 和复杂逻辑包含 JSDoc 注释
- 利用 TypeScript 的类型系统进行自文档化接口
- 结构化代码以遵循逻辑流程和关注点分离

**验证标准**:
- [ ] 所有公共函数都有 JSDoc 文档
- [ ] 变量和函数名清楚表达其目的
- [ ] TypeScript 类型提供清晰的接口契约
- [ ] 代码结构遵循逻辑组织模式

### 4. 标准优先
**原则**: 严格遵循 ESLint 规则以维护项目中统一的代码风格。

**实施方式**:
- 所有代码在提交前必须通过 ESLint 验证
- 使用一致的格式化规则（Prettier 集成）
- 遵循所有代码元素的既定命名约定
- 维护一致的导入排序和组织

**验证标准**:
- [ ] `pnpm lint` 通过且无错误
- [ ] 代码遵循既定的格式化标准
- [ ] 命名约定得到一致应用
- [ ] 导入语句遵循定义的排序规则

### 5. 组件参考优先级
**原则**: 始终首先查阅本地 `docs/_wiki/material-web` 文档以确保正确使用 Material Web 组件。

**实施方式**:
- 在实施前检查本地 Material Web 文档
- 遵循组件使用和主题化的文档化模式
- 使用既定的组件封装模式
- 与文档化的组件 API 保持一致

**验证标准**:
- [ ] Material Web 组件遵循文档化的使用模式
- [ ] 组件封装遵循既定约定
- [ ] 主题化使用文档化的令牌系统
- [ ] 组件 API 匹配文档化接口

### 6. 动态标准演进（自我演化）
**原则**: 每次任务完成后，主动评估变更是否引入新的设计模式、架构调整或标准约束。如果是，立即重构协议文档以维护标准与代码之间的实时同步。

**实施方式**:
- 审查每个完成的任务是否有新模式或标准
- 当新模式出现时更新相关协议文档
- 维护相关协议部分之间的交叉引用
- 确保协议演进得到记录和传达

**验证标准**:
- [ ] 新模式在适当的协议部分中得到记录
- [ ] 协议文档反映当前实施现实
- [ ] 标准变更时更新交叉引用
- [ ] 为可追溯性维护演进历史

## 原则应用指南

### 决策制定框架
在做出开发决策时，按以下优先级顺序应用原则：
1. **分离上下文架构** - 确保适当的关注点分离
2. **单一数据源** - 避免重复和魔法值
3. **标准优先** - 遵循既定的代码检查和格式化规则
4. **代码即文档** - 确保清晰性和可维护性
5. **组件参考优先级** - 使用文档化模式
6. **动态标准演进** - 需要时更新标准

### 冲突解决
当原则出现冲突时：
1. 优先考虑架构完整性（分离上下文架构）
2. 偏向可维护性而非便利性（单一数据源）
3. 选择清晰性而非简洁性（代码即文档）
4. 遵循既定模式而非创新（标准优先）

### 原则验证
每个原则都包含可以通过以下方式验证的具体验证标准：
- 通过代码检查和构建过程自动化
- 通过代码审查检查清单验证
- 通过架构合规工具验证
- 通过文档覆盖率指标测量

## 与其他协议文档的集成

这些原则通过以下方式实施：
- **[架构标准](./architecture.md)** - 分离上下文架构的结构实施
- **[编码标准](./coding-standards.md)** - 标准优先和代码即文档的执行
- **[工作流程](./workflow.md)** - 动态标准演进的实施
- **[验证标准](./validation.md)** - 所有原则的可测量验证

---

*这些原则构成了所有开发实践的基础。在做出架构决策、编写代码或更新项目标准时应参考这些原则。*