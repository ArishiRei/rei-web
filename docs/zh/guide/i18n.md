# 国际化开发指南 (I18n)

本项目使用 `@nuxtjs/i18n` 模块进行国际化管理。

## 目录结构

语言文件统一存放在 `app/i18n/locales/` 目录下：

```text
app/i18n/locales/
├── en.json       # 英语 (默认)
├── zh.json       # 简体中文
└── ...
```

## 翻译 Key 命名规范

采用 **模块.功能.语义** 的三级命名法，全小写，下划线分隔。

- **Good**: `auth.login.submit_btn`, `blog.post.read_more`
- **Bad**: `submit`, `ReadMore`, `authLoginButton`

## 使用指南

### 1. 在 Vue 模板中

使用 `$t()` 函数：

```vue
<template>
  <ReiButton>{{ $t('auth.login.submit_btn') }}</ReiButton>
</template>
```

### 2. 在 Script 中

使用 `useI18n()` 组合式函数：

```typescript
<script setup lang="ts">
const { t } = useI18n()

const title = computed(() => t('page.home.title'))
</script>
```

### 3. 添加新语言

1.  在 `app/i18n/locales/` 下创建新的 JSON 文件 (e.g. `ja.json`)。
2.  在 `nuxt.config.ts` 的 `i18n` 配置中注册新语言：

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  i18n: {
    locales: [
      { code: 'en', file: 'en.json' },
      { code: 'zh', file: 'zh.json' },
      { code: 'ja', file: 'ja.json' } // 新增
    ]
  }
})
```

## 高级用法

### 1. 带参数的翻译

```json
// zh.json
{
  "user": {
    "welcome": "欢迎回来，{name}！",
    "items_count": "您有 {count} 个项目"
  }
}
```

```vue
<template>
  <div>
    <p>{{ $t('user.welcome', { name: userName }) }}</p>
    <p>{{ $t('user.items_count', { count: itemCount }) }}</p>
  </div>
</template>
```

### 2. 复数形式处理

```json
// en.json
{
  "item": {
    "count": "no items | one item | {count} items"
  }
}
```

```vue
<template>
  <p>{{ $tc('item.count', itemCount, { count: itemCount }) }}</p>
</template>
```

### 3. 日期和数字格式化

```typescript
const { d, n } = useI18n()

// 日期格式化
const formattedDate = d(new Date(), 'short')

// 数字格式化
const formattedNumber = n(1234.56, 'currency')
```

### 4. 动态语言切换

```vue
<template>
  <select v-model="$i18n.locale">
    <option value="en">English</option>
    <option value="zh">中文</option>
  </select>
</template>

<script setup lang="ts">
const { locale, setLocale } = useI18n()

// 程序化切换语言
const switchLanguage = (lang: string) => {
  setLocale(lang)
}
</script>
```

## 配置选项

### 基础配置

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  i18n: {
    locales: [
      {
        code: 'en',
        file: 'en.json',
        name: 'English'
      },
      {
        code: 'zh',
        file: 'zh.json',
        name: '中文'
      }
    ],
    defaultLocale: 'zh',
    strategy: 'prefix_except_default',
    detectBrowserLanguage: {
      useCookie: true,
      cookieKey: 'i18n_redirected',
      redirectOn: 'root'
    }
  }
})
```

### SEO 优化

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  i18n: {
    baseUrl: 'https://example.com',
    seo: true,
    pages: {
      about: {
        en: '/about',
        zh: '/guanyu'
      }
    }
  }
})
```

## 最佳实践

### 1. 翻译文件组织

```json
// 推荐的文件结构
{
  "common": {
    "save": "保存",
    "cancel": "取消",
    "confirm": "确认"
  },
  "nav": {
    "home": "首页",
    "about": "关于",
    "contact": "联系"
  },
  "auth": {
    "login": {
      "title": "登录",
      "email": "邮箱",
      "password": "密码",
      "submit": "登录"
    }
  }
}
```

### 2. 类型安全

```typescript
// types/i18n.ts
export interface I18nMessages {
  common: {
    save: string
    cancel: string
  }
  auth: {
    login: {
      title: string
      email: string
    }
  }
}

// 使用类型化的翻译
const { t } = useI18n<I18nMessages>()
const title = t('auth.login.title') // 类型安全
```

### 3. 懒加载翻译

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  i18n: {
    lazy: true,
    langDir: 'locales/',
    locales: [
      {
        code: 'en',
        file: 'en.json'
      },
      {
        code: 'zh',
        file: 'zh.json'
      }
    ]
  }
})
```

### 4. 翻译验证

```bash
# 检查缺失的翻译键
pnpm i18n:check

# 自动生成翻译模板
pnpm i18n:generate
```

## 常见问题

### 1. 翻译不生效

检查以下几点：
- 确认翻译键是否正确
- 检查 JSON 文件语法是否正确
- 确认语言文件是否正确加载

### 2. 路由国际化

```typescript
// pages/about.vue
<script setup lang="ts">
// 自动生成 /en/about 和 /zh/guanyu 路由
definePageMeta({
  nuxtI18n: {
    en: 'about',
    zh: 'guanyu'
  }
})
</script>
```

### 3. 服务端渲染问题

```typescript
// 确保服务端和客户端语言一致
const { locale } = useI18n()

onMounted(() => {
  // 客户端挂载后的语言处理
  if (process.client) {
    // 客户端特定逻辑
  }
})
```

## 相关文档

- [Vue I18n 官方文档](https://vue-i18n.intlify.dev/)
- [Nuxt I18n 模块文档](https://i18n.nuxtjs.org/)
- [主题系统](./theming.md) - 多语言主题适配